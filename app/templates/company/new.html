{% extends "base.html" %}

{% block title %}Nueva Empresa{% endblock %}

{% block content %}
<div class="container">
  <h1 class="mb-4">Registrar Nueva Empresa</h1>
  <form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="row">
      <!-- Datos básicos -->
      <div class="col-md-6">
        <div class="mb-3">
          <label for="name" class="form-label">Nombre de la Empresa *</label>
          <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <div class="mb-3">
          <label for="rfc" class="form-label">RFC *</label>
          <input type="text" class="form-control" id="rfc" name="rfc" maxlength="13" required>
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Correo Electrónico *</label>
          <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
          <label for="phone" class="form-label">Teléfono *</label>
          <input type="tel" class="form-control" id="phone" name="phone" required>
        </div>
      </div>

      <!-- Dirección y logo -->
      <div class="col-md-6">
        <div class="mb-3">
          <label for="address" class="form-label">Dirección *</label>
          <input type="text" class="form-control" id="address" name="address" required>
        </div>
        <div class="mb-3">
          <label for="city" class="form-label">Ciudad *</label>
          <input type="text" class="form-control" id="city" name="city" required>
        </div>
        <div class="mb-3">
          <label for="postal_code" class="form-label">Código Postal *</label>
          <input type="text" class="form-control" id="postal_code" name="postal_code" maxlength="5" required>
        </div>
        <div class="mb-3">
          <label for="logo" class="form-label">Logo de la Empresa</label>
          <input type="file" class="form-control" id="logo" name="logo" accept="image/*">
          <div id="logo-preview" class="mt-2"></div>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-12">
        <button type="submit" class="btn btn-primary">Registrar Empresa</button>
        <a href="{{ url_for('company.list') }}" class="btn btn-secondary">Cancelar</a>
      </div>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Configuración específica para el formulario de empresa
  document.addEventListener('DOMContentLoaded', function() {
      // Configurar preview de logo
      setupImagePreview('logo', 'logo-preview');

      // Formatear el código postal automáticamente
      const postalCodeInput = document.getElementById('postal_code');
      if (postalCodeInput) {
          postalCodeInput.addEventListener('input', function(e) {
              this.value = this.value.replace(/\D/g, '').substr(0, 5);
          });
      }

      // Formatear el teléfono automáticamente
      const phoneInput = document.getElementById('phone');
      if (phoneInput) {
          phoneInput.addEventListener('input', function(e) {
              let cleaned = this.value.replace(/\D/g, '');
              if (cleaned.length > 10) cleaned = cleaned.substr(0, 10);
              if (cleaned.length >= 10) {
                  this.value = `(${cleaned.substr(0,3)}) ${cleaned.substr(3,3)}-${cleaned.substr(6)}`;
              } else if (cleaned.length >= 6) {
                  this.value = `(${cleaned.substr(0,3)}) ${cleaned.substr(3,3)}-${cleaned.substr(6)}`;
              } else if (cleaned.length >= 3) {
                  this.value = `(${cleaned.substr(0,3)}) ${cleaned.substr(3)}`;
              } else {
                  this.value = cleaned;
              }
          });
      }
  });
</script>
{% endblock %}